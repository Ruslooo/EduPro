{% extends 'common/base.html' %}
{% load static %}

{% block content %}
<!--    <form method="get"-->
<!--          style="display: flex; flex-flow: column wrap; max-width: 100px; gap: 15px; padding: 10px 10px 10px 0;">-->
<!--        <label for="id_department">-->
<!--            {{ filter.form.category }}-->
<!--        </label>-->
<!--        <label for="id_institute">-->
<!--            {{ filter.form.institute }}-->
<!--        </label>-->
<!--        <input type="submit"/>-->
<!--    </form>-->
    <ul class="list-articles">
        {% for post in posts %}
            <li>
                <div class="article-panel">
                    {% if post.author %}<p class="first">Автор: {{post.author}} &nbsp; </p> {% endif %}
                    {% if post.department %}<p class="first">Кафедра: {{post.department}}</p> {% endif %}
                    <p class="last">Дата: {{ post.time_update|date:"d-m-Y H:i:s" }}</p>
                </div>

                {% if post.photo %}
                    <p><img class="img-article-left thumb" src="{{ post.photo.url }}"></p>
                {% endif %}

                <h2>{{ post.title }}</h2>
                {% autoescape on %}
                    {{ post.content|linebreaks|truncatewords:50 }}
                {% endautoescape %}
                <div class="clear"></div>
                <div>

                </div>
                <div class="link-read-post"
                     style="display:flex; flex-flow: row nowrap; justify-content: flex-end; gap: 10px">


                {% if user.is_authenticated %}
                    <form action="{% url 'posts:blogpost_like' %}" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="post_id" value="{{post.id}}">
                        {% if user not in post.likes.all %}
                            <button type="submit"  class="btn btn-info">&#10084</button>
                        {% else %}
                            <button type="submit" class="btn btn-info">&#9829</button>
                        {% endif %}
                    </form>
                    <strong>{{ post.likes.all.count }} лайков</strong>
                    {% else %}
                    <a class="btn btn-outline-info" href="{% url 'profiles:login' %}?next={{request.path}}">Войдите, что бы поставить лайк!</a><br>
                    {% endif %}

                    <div><a href="{{ post.get_absolute_url }}">Читать пост</a></div>
                </div>
            </li>
        {% endfor %}
    </ul>
{% endblock %}


{% block SCRIPTS %}
    {{ block.super }}
    <script src="{% static 'common/js/script.js' %}"></script>
{% endblock %}